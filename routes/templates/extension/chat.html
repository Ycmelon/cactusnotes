<!DOCTYPE html>
<head>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
  />
  <script>
    function paste(text) {
      window.parent.postMessage(text,"https://www.carousell.sg")
    }

    function pasteLink() {
      paste(`Kindly find your notes at the link below:
${document.querySelector("#form-link").value}
PIN: ${document.querySelector("#form-pin").value}`)
    }

  </script>
</head>
<body>
  {% with messages = get_flashed_messages() %} {% if messages %}
  <div class="alert alert-primary alert-dismissible fade show" role="alert">
    <ul style="margin: 0">
      {% for message in messages %}
      <li>{{ message }}</li>
      {% endfor %}
    </ul>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>

  {% endif %} {% endwith %}
  <div class="mb-1">
    <label class="form-label"
      >Welcome, {{ session["admin"] }}
      <form action="/admin/logout" method="POST" style="display: inline">
        (<input
          type="submit"
          value="log out"
          style="
            padding: 0;
            border: none;
            background: none;
            color: var(--bs-primary);
            text-decoration: underline;
          "
        />)
      </form>
    </label>
  </div>
  <div class="mb-3">
    <label class="form-label"
      >Current customer: <span id="current-user">{{ username }}</span></label
    >
  </div>
  <form
    action="./update_customer?username={{ username | urlencode }}"
    method="POST"
  >
    <div class="mb-3">
      <label for="form-link" class="form-label"
        >User link (<a class="link-primary" href="#" onclick="pasteLink()"
          >copy to chat</a
        >)</label
      >
      <input
        type="text"
        name="link"
        readonly
        class="form-control"
        id="form-link"
        value="cactusnotes.co/{{ link }}"
      />
    </div>
    <div class="mb-3">
      <label for="form-pin" class="form-label">PIN</label>
      <input
        type="text"
        name="pin"
        readonly
        class="form-control"
        id="form-pin"
        value="{{ pin }}"
      />
    </div>
    <label for="form-documents" class="form-label">Documents</label>
    <div class="form-control mb-3" id="form-documents">
      {% for doc in all_documents %}
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="doc-{{
        doc['shortname'] }}" name="doc-{{ doc['shortname'] }}" {% if
        doc["shortname"] in documents %} checked {% endif %} />
        <label class="form-check-label" for="doc-{{ doc['shortname'] }}">
          {{ doc["filename"] }}
        </label>
        <i
          class="bi bi-info-circle"
          data-bs-toggle="modal"
          data-bs-target="#modal"
          data-bs-desc="{{ doc['chapter_desc'] }}"
          style="cursor: pointer"
        ></i>
        <input
          type="text"
          name="chapters-{{ doc['shortname'] }}"
          style="border: none; padding: 0; padding-left: 0.25em; color: grey"
          value="{% if doc['shortname'] in documents %}{{ documents[doc['shortname']] | rangelist_to_str }}{% endif %}"
        />
      </div>
      {% endfor %}
    </div>
    <div class="mb-3">
      <label for="form-transactions" class="form-label">Transactions</label>
      <table class="table table-bordered">
        <tr>
          <th scope="col">Date / admin</th>
          <th scope="col">Items</th>
          <th scope="col">Amount</th>
        </tr>
        {% for tsc in transactions %}
        <tr>
          <td>
            {{ tsc["timestamp"] | get_datetime_str_from_timestamp }} / {{
            tsc["admin"] }}
          </td>
          <td>{{ tsc["documents"] | documents_to_items_str }}</td>
          <td>{{ tsc["amount"] | format_money }}</td>
        </tr>
        {% endfor %}
        <tr>
          <td>
            <select class="form-select" name="admin">
              <option value="marcus" {% if session["admin"] == "marcus" %}selected{% endif %}>Marcus</option>
              <option value="ethan" {% if session["admin"] == "ethan" %}selected{% endif %}>Ethan</option>
              <option value="yc" {% if session["admin"] == "yc" %}selected{% endif %}>Yu Chen</option>
              <option value="jason" {% if session["admin"] == "jason" %}selected{% endif %}>Jason</option>
              <option value="jx" {% if session["admin"] == "jx" %}selected{% endif %}>Junxiang</option>
            </select>
          </td>
          <td>
            <input
              type="text"
              class="form-control"
              disabled
              value="(autofilled)"
            />
          </td>
          <td><input type="text" class="form-control" name="amount" /></td>
        </tr>
      </table>
    </div>
    <div>
      <button class="btn btn-primary">Update</button>
    </div>
  </form>

  <div class="modal fade" id="modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">
            Chapter description
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    var exampleModal = document.getElementById("modal");
    exampleModal.addEventListener("show.bs.modal", function (event) {
      var button = event.relatedTarget;
      var desc = button.getAttribute("data-bs-desc");
      exampleModal.querySelector(".modal-body span").innerText = desc;
    });
  </script>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
</body>
