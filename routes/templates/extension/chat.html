<!DOCTYPE html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
  />
  <script>
    function paste(text) {
      window.parent.postMessage(text, "https://www.carousell.sg");
    }

    function pasteLink() {
      paste(`Kindly find your notes at the link below:
${document.querySelector("#form-link").value}
PIN: ${document.querySelector("#form-pin").value}`);
    }

    function copy(text) {
      navigator.clipboard.writeText(text).then(()=>{});
    }

    function copyLink() {
      copy(`Kindly find your notes at the link below:
${document.querySelector("#form-link").value}
PIN: ${document.querySelector("#form-pin").value}`);
    }
  </script>
  <style></style>
</head>
<body style="margin:10px;">
  <div class="container px-0" style="max-width: 600px">

    <nav>
      <div class="nav nav-tabs mb-3" id="nav-tab" role="tablist">
        <button
          class="nav-link active"
          id="nav-sale-tab"
          data-bs-toggle="tab"
          data-bs-target="#nav-sale"
          type="button"
          role="tab"
        >
          Sale
        </button>
        <button
          class="nav-link"
          id="nav-copypasta-tab"
          data-bs-toggle="tab"
          data-bs-target="#nav-copypasta"
          type="button"
          role="tab"
        >
          Copypasta
        </button>
        <!-- <button
          class="nav-link"
          id="nav-settings-tab"
          data-bs-toggle="tab"
          data-bs-target="#nav-settings"
          type="button"
          role="tab"
        >
          Settings
        </button> -->
      </div>
    </nav>


    <div class="tab-content" id="nav-tabContent" style="width: 100%; height: 90%">
      <div
        class="tab-pane fade show active"
        id="nav-sale"
        role="tabpanel"
        style="width: 100%; height: 100%"
      >
        
      {% with messages = get_flashed_messages() %} {% if messages %}
    <div class="alert alert-primary alert-dismissible fade show" role="alert">
      <ul style="margin: 0">
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
      </ul>
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="alert"
        aria-label="Close"
      ></button>
    </div>

    {% endif %} {% endwith %}
    <div class="row align-items-center gx-2 mb-2">
      <div class="col">
        <label class="form-label mb-0 h5">
          Welcome, {{ session["admin"] }}
        </label>
      </div>
      {% if not extension_mode %}
      <div class="col-auto">
        <a href="/admin/" class="btn btn-outline-primary">Back to dashboard</a>
      </div>
      {% endif %}
      <div class="col-auto">
        <form action="/admin/logout" method="POST">
          <input type="submit" class="btn btn-primary" value="Log out" />
        </form>
      </div>
    </div>
    {% if not extension_mode %}
    <input
      type="text"
      class="form-control"
      placeholder="Jump to customer..."
      onkeypress="jumpToCustomer(event)"
      id="jump-username"
    />
    <script>
      function jumpToCustomer(event) {
        if (event.key == "Enter") {
          const params = new URLSearchParams(window.location.search);
          params.set(
            "username",
            document.querySelector("#jump-username").value
          );
          window.location.href = `${
            window.location.pathname
          }?${params.toString()}`;
        }
      }
    </script>
    {% endif %}
    <hr />
    <div class="mb-3">
      <label class="form-label" for="current-customer">Current customer</label>
      <input
        type="text"
        disabled
        class="form-control"
        id="current-customer"
        value="{{ username }}"
      />
    </div>
    <form
      action="./update_customer?username={{ username | urlencode }}"
      method="POST"
    >
      <div class="mb-3">
        <label for="form-link" class="form-label"
          >User link {% if extension_mode %}(<a class="link-primary" href="#" onclick="pasteLink()">copy to chat</a>)
            {% else %}(<a class="link-primary" href="#" onclick="copyLink()">copy to clipboard</a>)
            {% endif %}</label>
        <input
          type="text"
          name="link"
          readonly
          class="form-control"
          id="form-link"
          value="cactusnotes.co/{{ link }}"
        />
      </div>
      <div class="mb-3">
        <label for="form-pin" class="form-label">PIN</label>
        <input
          type="text"
          name="pin"
          readonly
          class="form-control"
          id="form-pin"
          value="{{ pin }}"
        />
      </div>
      <label for="form-documents" class="form-label">Documents</label>
      <div class="form-control mb-3" id="form-documents">
        {% for doc in all_documents %}
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="doc-{{
          doc['shortname'] }}" name="doc-{{ doc['shortname'] }}" {% if
          doc["shortname"] in documents %} checked {% endif %} />
          <label class="form-check-label" for="doc-{{ doc['shortname'] }}">
            {{ doc["filename"] }}
          </label>
          <i
            class="bi bi-info-circle"
            data-bs-toggle="modal"
            data-bs-target="#modal"
            data-bs-desc="{{ doc['chapter_desc'] }}"
            style="cursor: pointer"
          ></i>
          <input
            type="text"
            name="chapters-{{ doc['shortname'] }}"
            style="border: none; padding: 0; padding-left: 0.25em; color: grey"
            value="{% if doc['shortname'] in documents %}{{ documents[doc['shortname']] | rangelist_to_str }}{% endif %}"
          />
        </div>
        {% endfor %}
      </div>
      <div class="mb-3">
        <label for="form-transactions" class="form-label">Transactions</label>
        <table class="table table-bordered">
          <tr>
            <th scope="col">Date / admin</th>
            <th scope="col">Items</th>
            <th scope="col">Amount</th>
          </tr>
          {% for tsc in transactions %}
          <tr>
            <td>
              {{ tsc["timestamp"] | get_datetime_str_from_timestamp }} / {{
              tsc["admin"] }}
            </td>
            <td>{{ tsc["documents"] | documents_to_items_str }}</td>
            <td>{{ tsc["amount"] | format_money }}</td>
          </tr>
          {% endfor %}
          <tr>
            <td>
              <select class="form-select" name="admin">
              <option value="marcus" {% if session["admin"] == "marcus" %}selected{% endif %}>Marcus</option>
              <option value="ethan" {% if session["admin"] == "ethan" %}selected{% endif %}>Ethan</option>
              <option value="yc" {% if session["admin"] == "yc" %}selected{% endif %}>Yu Chen</option>
              <option value="jason" {% if session["admin"] == "jason" %}selected{% endif %}>Jason</option>
              <option value="jx" {% if session["admin"] == "jx" %}selected{% endif %}>Junxiang</option>
              </select>
            </td>
            <td>
              <input
                type="text"
                class="form-control"
                disabled
                value="(autofilled)"
              />
            </td>
            <td><input type="text" class="form-control" name="amount" /></td>
          </tr>
        </table>
      </div>
      <div>
        <button class="btn btn-primary">Update</button>
      </div>
    </form>


      </div>
      <div class="tab-pane fade" id="nav-copypasta" role="tabpanel">
        <style>
          .copypasta-card {
            cursor: pointer;
          }
        </style>
    
        <div class="card mb-2 copypasta-card">
          <div class="p-2">
            Hi, thank you for your interest! Would you like to take a look at our
            samples first? The samples can be found at cactusnotes.co/samples
          </div>
        </div>
        <div class="card mb-2 copypasta-card">
          <div class="p-2">
            Hi, thank you for your interest! The samples can be found at
            cactusnotes.co/samples
          </div>
        </div>
        <div class="card mb-2 copypasta-card">
          <div class="p-2">
            Do let us know if you would like to proceed with the purchase, and which
            notes you would like to buy :)
          </div>
        </div>
        <div class="card mb-2 copypasta-card">
          <div class="p-2">
            Do let us know if you face any difficulties downloading or if you have
            any queries academic or otherwise. We will appreciate if you could help
            leave a review if the notes are up to your expectations :)
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="nav-settings" role="tabpanel">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="condensed-switch" />
          <label class="form-check-label" for="condensed-switch"
            >Condensed chat view</label
          >
        </div>
      </div>
    </div>
    

    

    <div class="modal fade" id="modal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">
              Chapter description
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <script>
      var exampleModal = document.getElementById("modal");
      exampleModal.addEventListener("show.bs.modal", function (event) {
        var button = event.relatedTarget;
        var desc = button.getAttribute("data-bs-desc");
        exampleModal.querySelector(".modal-body span").innerText = desc;
      });
    </script>

<script>
  var triggerTabList = [].slice.call(
    document.querySelectorAll("#nav-tab button")
  );
  triggerTabList.forEach(function (triggerEl) {
    var tabTrigger = new bootstrap.Tab(triggerEl);

    triggerEl.addEventListener("click", function (event) {
      event.preventDefault();
      tabTrigger.show();
    });
  });
</script>

<script>
  document.querySelectorAll("div.copypasta-card").forEach((card) => {
    card.addEventListener("click", (event) => {
      //{% if extension_mode %}
      paste(card.innerText);
      //{% else %}
      copy(card.innerText);
      //{% endif %}
    });
  });
</script>


    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>


  </div>
</body>
